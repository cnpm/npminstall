sudo: false
env:
  - CC=clang CXX=clang++ npm_config_clang=1 npm_registry=https://registry.npmjs.org
language: node_js
node_js:
  - '7'
  - '6'
  - '4'
matrix:
  include:
    - node_js: '8'
      env: 'NVM_NODEJS_ORG_MIRROR=https://nodejs.org/download/nightly'
  allow_failures:
    # Allow the nightly installs to fail
    - env: 'NVM_NODEJS_ORG_MIRROR=https://nodejs.org/download/nightly'
before_script:
  - echo -e "Host *\n\tStrictHostKeyChecking no\n" >> ~/.ssh/config
script:
  - 'npm run ci'
  - 'sh test/git-clone-install.sh'
  - 'node test/all.js'
after_script:
  - 'npm i codecov && codecov'
